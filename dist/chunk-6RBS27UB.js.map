{"version":3,"sources":["../src/assets/utils/index.ts","../src/assets/hooks/useAssetState.ts"],"sourcesContent":["import {Assets} from 'pixi.js';\n\nimport type {UnresolvedAsset} from 'pixi.js';\n\nexport const key = (url: string | UnresolvedAsset) =>\n  typeof url === 'string' ? url : (url.alias ?? url.src ?? '')?.toString();\n\nexport const createKey = (urls: string | UnresolvedAsset | string[] | UnresolvedAsset[]) =>\n  new Set(Array.isArray(urls) ? urls.map(key) : key(urls));\n\nexport const didKeyChange = (\n  urls: string | UnresolvedAsset | string[] | UnresolvedAsset[],\n  keys: Set<string>,\n) => (Array.isArray(urls) ? !urls.every(url => keys.has(key(url))) : !keys.has(key(urls)));\n\nexport const isLoaded = (urls: string | UnresolvedAsset | string[] | UnresolvedAsset[]) =>\n  Array.isArray(urls) ? urls.every(url => Assets.cache.has(key(url))) : Assets.cache.has(key(urls));\n\nexport const isBundleLoaded = (bundles: string | string[]) =>\n  Array.isArray(bundles)\n    ? bundles.every(bundle => Assets.resolver.hasBundle(bundle))\n    : Assets.resolver.hasBundle(bundles);\n\nexport const resolve = (urls: string | UnresolvedAsset | string[] | UnresolvedAsset[]) =>\n  Array.isArray(urls)\n    ? urls.reduce((acc, url) => {\n        const k = key(url);\n        if (Assets.cache.has(k)) acc[k] = Assets.cache.get(k);\n        return acc;\n      }, {} as Record<string, any>)\n    : Assets.cache.get(key(urls));\n\nexport const resolveBundle = (bundles: string | string[]) =>\n  Assets.resolver.resolveBundle(bundles) as any;\n","import {useEffect, useState} from 'react';\nimport {didKeyChange, createKey} from '../utils';\n\nimport type {UnresolvedAsset} from 'pixi.js';\nimport type {AssetState, HookState} from '../types';\n\ntype AssetStateReturn<T> = {\n  state: AssetState<T>;\n  setState: (state: AssetState<T>) => void;\n  thenable: Promise<T>;\n};\n\nexport function useAssetState<T>(\n  urls: string | UnresolvedAsset | string[] | UnresolvedAsset[],\n  isLoaded: (urls: any) => boolean,\n  load: <T>(urls: any) => Promise<T>,\n  resolve: <T>(urls: any) => T,\n): AssetStateReturn<T | Record<string, T>> {\n  const [assetState, setAssetState] = useState<AssetState<T | Record<string, T>>>(() => ({\n    isLoaded: isLoaded(urls),\n    error: null,\n    data: resolve(urls),\n  }));\n\n  const [state, setState] = useState<HookState<T>>(() => ({\n    thenable: !assetState.isLoaded ? load(urls) : undefined,\n    key: createKey(urls),\n  }));\n\n  useEffect(() => {\n    if (didKeyChange(urls, state.key)) {\n      const assetsLoaded = isLoaded(urls);\n      setState(state => ({\n        thenable: assetsLoaded ? state.thenable : load(urls),\n        key: createKey(urls),\n      }));\n      setAssetState({isLoaded: assetsLoaded, error: null, data: resolve(urls)});\n    }\n  }, [urls, state.key]);\n\n  return {state: assetState, setState: setAssetState, thenable: state.thenable};\n}\n"],"mappings":";AAAA,SAAQ,cAAa;AAId,IAAM,MAAM,CAAC,QAA+B;AAJnD;AAKE,gBAAO,QAAQ,WAAW,OAAO,SAAI,SAAS,IAAI,OAAO,OAAxB,mBAA6B;AAAA;AAEzD,IAAM,YAAY,CAAC,SACxB,IAAI,IAAI,MAAM,QAAQ,IAAI,IAAI,KAAK,IAAI,GAAG,IAAI,IAAI,IAAI,CAAC;AAElD,IAAM,eAAe,CAC1B,MACA,SACI,MAAM,QAAQ,IAAI,IAAI,CAAC,KAAK,MAAM,SAAO,KAAK,IAAI,IAAI,GAAG,CAAC,CAAC,IAAI,CAAC,KAAK,IAAI,IAAI,IAAI,CAAC;AAEjF,IAAM,WAAW,CAAC,SACvB,MAAM,QAAQ,IAAI,IAAI,KAAK,MAAM,SAAO,OAAO,MAAM,IAAI,IAAI,GAAG,CAAC,CAAC,IAAI,OAAO,MAAM,IAAI,IAAI,IAAI,CAAC;AAE3F,IAAM,iBAAiB,CAAC,YAC7B,MAAM,QAAQ,OAAO,IACjB,QAAQ,MAAM,YAAU,OAAO,SAAS,UAAU,MAAM,CAAC,IACzD,OAAO,SAAS,UAAU,OAAO;AAEhC,IAAM,UAAU,CAAC,SACtB,MAAM,QAAQ,IAAI,IACd,KAAK,OAAO,CAAC,KAAK,QAAQ;AACxB,QAAM,IAAI,IAAI,GAAG;AACjB,MAAI,OAAO,MAAM,IAAI,CAAC,EAAG,KAAI,CAAC,IAAI,OAAO,MAAM,IAAI,CAAC;AACpD,SAAO;AACT,GAAG,CAAC,CAAwB,IAC5B,OAAO,MAAM,IAAI,IAAI,IAAI,CAAC;AAEzB,IAAM,gBAAgB,CAAC,YAC5B,OAAO,SAAS,cAAc,OAAO;;;ACjCvC,SAAQ,WAAW,gBAAe;AAY3B,SAAS,cACd,MACAA,WACA,MACAC,UACyC;AACzC,QAAM,CAAC,YAAY,aAAa,IAAI,SAA4C,OAAO;AAAA,IACrF,UAAUD,UAAS,IAAI;AAAA,IACvB,OAAO;AAAA,IACP,MAAMC,SAAQ,IAAI;AAAA,EACpB,EAAE;AAEF,QAAM,CAAC,OAAO,QAAQ,IAAI,SAAuB,OAAO;AAAA,IACtD,UAAU,CAAC,WAAW,WAAW,KAAK,IAAI,IAAI;AAAA,IAC9C,KAAK,UAAU,IAAI;AAAA,EACrB,EAAE;AAEF,YAAU,MAAM;AACd,QAAI,aAAa,MAAM,MAAM,GAAG,GAAG;AACjC,YAAM,eAAeD,UAAS,IAAI;AAClC,eAAS,CAAAE,YAAU;AAAA,QACjB,UAAU,eAAeA,OAAM,WAAW,KAAK,IAAI;AAAA,QACnD,KAAK,UAAU,IAAI;AAAA,MACrB,EAAE;AACF,oBAAc,EAAC,UAAU,cAAc,OAAO,MAAM,MAAMD,SAAQ,IAAI,EAAC,CAAC;AAAA,IAC1E;AAAA,EACF,GAAG,CAAC,MAAM,MAAM,GAAG,CAAC;AAEpB,SAAO,EAAC,OAAO,YAAY,UAAU,eAAe,UAAU,MAAM,SAAQ;AAC9E;","names":["isLoaded","resolve","state"]}